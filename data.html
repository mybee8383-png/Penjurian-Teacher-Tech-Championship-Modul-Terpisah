<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TTC • Modul Data</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-blue-100 text-slate-800">
<div class="max-w-6xl mx-auto p-6">
  <header class="mb-6 flex items-center gap-3">
    <img src="assets/logo_ttc.png" alt="Teacher Tech Championship" class="h-12 w-auto" />
    <h1 class="text-2xl md:text-3xl font-bold">Teacher Tech Championship — Modul Data</h1>
  </header>

  <div id="toast" class="hidden rounded-lg px-4 py-3 mb-4 text-sm"></div>

  <!-- Sekolah -->
  <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-5 mb-6">
    <h2 class="text-lg font-semibold mb-4">A. Daftar Sekolah & Wilayah</h2>
    <div class="flex items-end gap-3 mb-3">
      <label class="block">
        <span class="text-sm">Jumlah Sekolah</span>
        <input id="nSek" type="number" min="1" value="4" class="mt-1 w-40 rounded-md border-slate-300 bg-sky-50 focus:border-indigo-500 focus:ring-indigo-500" />
      </label>
      <button id="btnSek" type="button" class="rounded-md bg-slate-800 hover:bg-slate-900 text-white px-4 py-2">Buat Form</button>
    </div>
    <div id="wrapSek" class="grid md:grid-cols-2 gap-3"></div>
  </section>

  <!-- Aspek -->
  <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-5 mb-6">
    <h2 class="text-lg font-semibold mb-4">B. Aspek Penilaian & Bobot</h2>
    <div class="flex items-end gap-3 mb-3">
      <label class="block">
        <span class="text-sm">Jumlah Aspek</span>
        <input id="nAsp" type="number" min="1" value="4" class="mt-1 w-40 rounded-md border-slate-300 bg-sky-50 focus:border-indigo-500 focus:ring-indigo-500" />
      </label>
      <button id="btnAsp" type="button" class="rounded-md bg-slate-800 hover:bg-slate-900 text-white px-4 py-2">Buat Form</button>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full text-sm border border-slate-200 rounded-lg overflow-hidden">
        <thead class="bg-slate-50">
          <tr><th class="px-3 py-2 text-left">#</th><th class="px-3 py-2 text-left">Nama Aspek</th><th class="px-3 py-2 text-left">Bobot (%)</th></tr>
        </thead>
        <tbody id="tbodyAsp" class="[&_tr:nth-child(even)]:bg-slate-50"></tbody>
        <tfoot class="bg-slate-100">
          <tr>
            <td class="px-3 py-2 font-medium" colspan="2">Total Bobot</td>
            <td class="px-3 py-2 font-semibold">
              <span id="sumBobot">0</span>% <span id="warnBobot" class="ml-2 text-xs font-medium"></span>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </section>

  <!-- Juri -->
  <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-5 mb-6">
    <h2 class="text-lg font-semibold mb-4">C. Nama Para Juri</h2>
    <div class="flex items-end gap-3 mb-3">
      <label class="block">
        <span class="text-sm">Jumlah Juri</span>
        <input id="nJuri" type="number" min="1" value="3" class="mt-1 w-40 rounded-md border-slate-300 bg-sky-50 focus:border-indigo-500 focus:ring-indigo-500" />
      </label>
      <button id="btnJuri" type="button" class="rounded-md bg-slate-800 hover:bg-slate-900 text-white px-4 py-2">Buat Form</button>
    </div>
    <div id="wrapJuri" class="grid md:grid-cols-3 gap-3"></div>
  </section>

  <!-- Simpan -->
  <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-5">
    <div class="flex flex-wrap gap-3">
      <button id="btnSave" type="button" class="rounded-md bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2">Simpan Konfigurasi</button>
      <button id="btnReset" type="button" class="rounded-md border border-slate-300 hover:bg-slate-50 px-4 py-2">Reset Semua Data</button>
    </div>
    <p class="text-xs text-slate-500 mt-2">Data disimpan lokal di browser. Setelah disimpan, Anda akan kembali ke beranda.</p>
  </section>
</div>

<script>
const $=s=>document.querySelector(s);
const toast=(msg,ok=true)=>{const t=$("#toast");t.classList.remove("hidden");t.className="rounded-lg px-4 py-3 mb-4 text-sm "+(ok?"bg-emerald-50 border border-emerald-200 text-emerald-900":"bg-rose-50 border border-rose-200 text-rose-900");t.textContent=msg;setTimeout(()=>t.classList.add("hidden"),1600);}
const saveCfg=cfg=>localStorage.setItem("TTC_config",JSON.stringify(cfg));
const getCfg = ()=>JSON.parse(localStorage.getItem("TTC_config")||"null");

function renderSek(n){
  const w=$("#wrapSek"); w.innerHTML="";
  for(let i=0;i<n;i++){
    const div=document.createElement("div");
    div.className="grid grid-cols-2 gap-2 bg-slate-50 border border-slate-200 rounded-lg p-3";
    div.innerHTML=`
      <label class="text-sm">Nama Sekolah
        <input id="sek${i}" class="mt-1 w-full rounded-md border-slate-300 bg-sky-50 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Sekolah ${i+1}">
      </label>
      <label class="text-sm">Wilayah
        <input id="wil${i}" class="mt-1 w-full rounded-md border-slate-300 bg-sky-50 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Wilayah">
      </label>`;
    w.appendChild(div);
  }
}

function renderAsp(n){
  const tb=$("#tbodyAsp"); tb.innerHTML="";
  for(let i=0;i<n;i++){
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td class="px-3 py-2">${i+1}</td>
      <td class="px-3 py-2"><input id="asp${i}" class="w-full rounded-md border-slate-300 bg-sky-50 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Aspek ${i+1}"></td>
      <td class="px-3 py-2"><input id="bob${i}" type="number" min="0" max="100" step="1" class="w-28 rounded-md border-slate-300 bg-sky-50 focus:border-indigo-500 focus:ring-indigo-500"></td>`;
    tb.appendChild(tr);
  }
  tb.querySelectorAll("input[type=number]").forEach(inp=>inp.addEventListener("input",sumBobot));
  sumBobot();
}
function sumBobot(){
  const n=parseInt($("#nAsp").value||"0",10); let s=0;
  for(let i=0;i<n;i++){ s+= parseFloat($("#bob"+i)?.value||"0")||0; }
  $("#sumBobot").textContent=s;
  const w=$("#warnBobot"); w.textContent=(s===100?"✓ valid":"Total harus 100%"); w.className="ml-2 text-xs font-medium "+(s===100?"text-emerald-700":"text-rose-700");
}

function renderJuri(n){
  const w=$("#wrapJuri"); w.innerHTML="";
  for(let i=0;i<n;i++){
    const div=document.createElement("div");
    div.className="bg-slate-50 border border-slate-200 rounded-lg p-3";
    div.innerHTML=`<label class="text-sm">Nama Juri ${i+1}
      <input id="juri${i}" class="mt-1 w-full rounded-md border-slate-300 bg-sky-50 focus:border-indigo-500 focus:ring-indigo-500" placeholder="mis: Rina Andini">
    </label>`;
    w.appendChild(div);
  }
}

$("#btnSek").onclick=()=>renderSek(parseInt($("#nSek").value||"0",10));
$("#btnAsp").onclick=()=>renderAsp(parseInt($("#nAsp").value||"0",10));
$("#btnJuri").onclick=()=>renderJuri(parseInt($("#nJuri").value||"0",10));

(function(){
  const cfg=getCfg();
  if(cfg){
    $("#nSek").value=cfg.sekolahs.length; renderSek(cfg.sekolahs.length);
    cfg.sekolahs.forEach((s,i)=>{ $("#sek"+i).value=s.nama; $("#wil"+i).value=s.wilayah; });
    $("#nAsp").value=cfg.aspek.length; renderAsp(cfg.aspek.length);
    cfg.aspek.forEach((a,i)=>{ $("#asp"+i).value=a.nama; $("#bob"+i).value=a.bobot; });
    $("#nJuri").value=cfg.judges.length; renderJuri(cfg.judges.length);
    cfg.judges.forEach((j,i)=>{ $("#juri"+i).value=j; });
    toast("Konfigurasi dimuat");
  }else{
    renderSek(parseInt($("#nSek").value,10));
    renderAsp(parseInt($("#nAsp").value,10));
    renderJuri(parseInt($("#nJuri").value,10));
  }
})();

document.getElementById('btnSave').onclick = () => {
  const nSek=parseInt($("#nSek").value||"0",10),
        nAsp=parseInt($("#nAsp").value||"0",10),
        nJuri=parseInt($("#nJuri").value||"0",10);

  const sekolahs=[];
  for(let i=0;i<nSek;i++){
    const nama=$("#sek"+i).value.trim(), wilayah=$("#wil"+i).value.trim();
    if(!nama||!wilayah){ toast("Nama sekolah & wilayah wajib",false); return; }
    sekolahs.push({nama,wilayah});
  }

  const aspek=[]; let sum=0;
  for(let i=0;i<nAsp;i++){
    const nama=$("#asp"+i).value.trim(), bobot=parseFloat($("#bob"+i).value||"0");
    if(!nama){ toast("Nama aspek wajib",false); return; }
    if(isNaN(bobot)){ toast("Bobot harus angka",false); return; }
    aspek.push({nama,bobot}); sum+=bobot;
  }
  if(sum!==100){ toast("Total bobot harus 100%",false); return; }

  const judges=[];
  for(let i=0;i<nJuri;i++){
    const nm=$("#juri"+i).value.trim();
    if(!nm){ toast("Nama juri tidak boleh kosong",false); return; }
    judges.push(nm);
  }

  saveCfg({sekolahs,aspek,judges});
  toast("Konfigurasi tersimpan ✓");
  setTimeout(()=>{ window.location.replace('./'); }, 300);
};

document.getElementById('btnReset').onclick=()=>{
  if(!confirm("Hapus semua data (config + nilai juri)?")) return;
  Object.keys(localStorage).forEach(k=>{ if(k.startsWith("TTC_")) localStorage.removeItem(k); });
  location.reload();
};
</script>
</body>
</html>
